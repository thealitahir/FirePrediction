
(function($){"use strict";var extensionMethods={pips:function(settings){var slider=this,i,j,p,collection="",mousedownHandlers=$._data(slider.element.get(0),"events").mousedown,originalMousedown,min=slider._valueMin(),max=slider._valueMax(),value=slider._value(),values=slider._values(),pips=(max-min)/slider.options.step,$handles=slider.element.find(".ui-slider-handle"),$pips;var options={first:"label",last:"label",rest:"pip",labels:false,prefix:"",suffix:"",step:(pips>100)?Math.floor(pips*0.05):1,formatLabel:function(value){return this.prefix+value+this.suffix;}};$.extend(options,settings);slider.options.pipStep=options.step;slider.element.addClass("ui-slider-pips").find(".ui-slider-pip").remove();var selectPip={single:function(value){this.resetClasses();$pips.filter(".ui-slider-pip-"+this.classLabel(value)).addClass("ui-slider-pip-selected");if(slider.options.range){$pips.each(function(k,v){var pipVal=$(v).children(".ui-slider-label").data("value");if((slider.options.range==="min"&&pipVal<value)||(slider.options.range==="max"&&pipVal>value)){$(v).addClass("ui-slider-pip-inrange");}});}},range:function(values){this.resetClasses();for(i=0;i<values.length;i++){$pips.filter(".ui-slider-pip-"+this.classLabel(values[i])).addClass("ui-slider-pip-selected-"+(i+1));}
    if(slider.options.range){$pips.each(function(k,v){var pipVal=$(v).children(".ui-slider-label").data("value");if(pipVal>values[0]&&pipVal<values[1]){$(v).addClass("ui-slider-pip-inrange");}});}},classLabel:function(value){return value.toString().replace(".","-");},resetClasses:function(){var regex=/(^|\s*)(ui-slider-pip-selected|ui-slider-pip-inrange)(-{1,2}\d+|\s|$)/gi;$pips.removeClass(function(index,css){return(css.match(regex)||[]).join(" ");});}};function getClosestHandle(val){var h,k,sliderVals,comparedVals,closestVal,tempHandles=[],closestHandle=0;if(values&&values.length){sliderVals=slider.element.slider("values");comparedVals=$.map(sliderVals,function(v){return Math.abs(v-val);});closestVal=Math.min.apply(Math,comparedVals);for(h=0;h<comparedVals.length;h++){if(comparedVals[h]===closestVal){tempHandles.push(h);}}
    closestHandle=tempHandles[0];for(k=0;k<tempHandles.length;k++){if(slider._lastChangedValue===tempHandles[k]){closestHandle=tempHandles[k];}}}
    return closestHandle;}
    function labelClick(label){if(slider.option("disabled")){return;}
        var val=$(label).data("value"),indexToChange=getClosestHandle(val);if(values&&values.length){slider.element.slider("values",indexToChange,val);}else{slider.element.slider("value",val);}
        slider._lastChangedValue=indexToChange;}
    function createPip(which){var label,percent,number=which,classes="ui-slider-pip",css="";if("first"===which){number=0;}
    else if("last"===which){number=pips;}
        var labelValue=min+(slider.options.step*number);var classLabel=labelValue.toString().replace(".","-");if($.type(options.labels)==="array"){label=options.labels[number]||"";}
        else if($.type(options.labels)==="object"){if("first"===which){label=options.labels.first||"";}
        else if("last"===which){label=options.labels.last||"";}
        else if($.type(options.labels.rest)==="array"){label=options.labels.rest[number-1]||"";}
        else{label=labelValue;}}
        else{label=labelValue;}
        if("first"===which){percent="0%";classes+=" ui-slider-pip-first";classes+=("label"===options.first)?" ui-slider-pip-label":"";classes+=(false===options.first)?" ui-slider-pip-hide":"";}else if("last"===which){percent="100%";classes+=" ui-slider-pip-last";classes+=("label"===options.last)?" ui-slider-pip-label":"";classes+=(false===options.last)?" ui-slider-pip-hide":"";}else{percent=((100/pips)*which).toFixed(4)+"%";classes+=("label"===options.rest)?" ui-slider-pip-label":"";classes+=(false===options.rest)?" ui-slider-pip-hide":"";}
        classes+=" ui-slider-pip-"+classLabel;if(values&&values.length){for(i=0;i<values.length;i++){if(labelValue===values[i]){classes+=" ui-slider-pip-initial-"+(i+1);classes+=" ui-slider-pip-selected-"+(i+1);}}
            if(slider.options.range){if(labelValue>values[0]&&labelValue<values[1]){classes+=" ui-slider-pip-inrange";}}}else{if(labelValue===value){classes+=" ui-slider-pip-initial";classes+=" ui-slider-pip-selected";}
            if(slider.options.range){if((slider.options.range==="min"&&labelValue<value)||(slider.options.range==="max"&&labelValue>value)){classes+=" ui-slider-pip-inrange";}}}
        css=(slider.options.orientation==="horizontal")?"left: "+percent:"bottom: "+percent;return"<span class=\""+classes+"\" style=\""+css+"\">"+"<span class=\"ui-slider-line\"></span>"+"<span class=\"ui-slider-label\" data-value=\""+labelValue+"\">"+options.formatLabel(label)+"</span>"+"</span>";}
    slider.options.pipStep=Math.round(slider.options.pipStep);collection+=createPip("first");for(p=1;p<pips;p++){if(p%slider.options.pipStep===0){collection+=createPip(p);}}
    collection+=createPip("last");slider.element.append(collection);$pips=slider.element.find(".ui-slider-pip");for(j=0;j<mousedownHandlers.length;j++){if(mousedownHandlers[j].namespace==="slider"){originalMousedown=mousedownHandlers[j].handler;}}
    slider.element.off("mousedown.slider").on("mousedown.selectPip",function(e){var $target=$(e.target),closest=getClosestHandle($target.data("value")),$handle=$handles.eq(closest);$handle.addClass("ui-state-active");if($target.is(".ui-slider-label")){labelClick($target);slider.element.one("mouseup.selectPip",function(){$handle.removeClass("ui-state-active").focus();});}else{originalMousedown(e);}});slider.element.on("slide.selectPip slidechange.selectPip",function(e,ui){var $slider=$(this),value=$slider.slider("value"),values=$slider.slider("values");if(ui){value=ui.value;values=ui.values;}
        if(values&&values.length){selectPip.range(values);}else{selectPip.single(value);}});},float:function(settings){var i,slider=this,min=slider._valueMin(),max=slider._valueMax(),value=slider._value(),values=slider._values(),tipValues=[],$handles=slider.element.find(".ui-slider-handle");var options={handle:true,pips:false,labels:false,prefix:"",suffix:"",event:"slidechange slide",formatLabel:function(value){return this.prefix+value+this.suffix;}};$.extend(options,settings);if(value<min){value=min;}
    if(value>max){value=max;}
    if(values&&values.length){for(i=0;i<values.length;i++){if(values[i]<min){values[i]=min;}
        if(values[i]>max){values[i]=max;}}}
    slider.element.addClass("ui-slider-float").find(".ui-slider-tip, .ui-slider-tip-label").remove();function getPipLabels(values){var vals=[],steppedVals=$.map(values,function(v){return Math.ceil((v-min)/slider.options.step);});if($.type(options.labels)==="array"){for(i=0;i<values.length;i++){vals[i]=options.labels[steppedVals[i]]||values[i];}}
    else if($.type(options.labels)==="object"){for(i=0;i<values.length;i++){if(values[i]===min){vals[i]=options.labels.first||min;}
    else if(values[i]===max){vals[i]=options.labels.last||max;}
    else if($.type(options.labels.rest)==="array"){vals[i]=options.labels.rest[steppedVals[i]-1]||values[i];}
    else{vals[i]=values[i];}}}
    else{for(i=0;i<values.length;i++){vals[i]=values[i];}}
        return vals;}
    if(options.handle){tipValues=(values&&values.length)?getPipLabels(values):getPipLabels([value]);for(i=0;i<tipValues.length;i++){$handles.eq(i).append($("<span class=\"ui-slider-tip\">"+options.formatLabel(tipValues[i])+"</span>"));}}
    if(options.pips){slider.element.find(".ui-slider-label").each(function(k,v){var $this=$(v),val=[$this.data("value")],label,$tip;label=options.formatLabel(getPipLabels(val)[0]);$tip=$("<span class=\"ui-slider-tip-label\">"+label+"</span>").insertAfter($this);});}
    if(options.event!=="slide"&&options.event!=="slidechange"&&options.event!=="slide slidechange"&&options.event!=="slidechange slide"){options.event="slidechange slide";}
    slider.element.on(options.event,function(e,ui){var uiValue=($.type(ui.value)==="array")?ui.value:[ui.value],val=options.formatLabel(getPipLabels(uiValue)[0]);$(ui.handle).find(".ui-slider-tip").html(val);});}};$.extend(true,$.ui.slider.prototype,extensionMethods);})(jQuery);